{% extends 'layouts/base.html' %}
{% from 'macros/comics.html' import issue_card %}
{% block title %}Releases for {{ date }} | Longboxed{% endblock title %}

{% block content -%}
<div class="header releases-header">
  <div class="container">
    <div class="row centered">
      <div class="col-sm-8 col-sm-offset-2">
        <h1>{{ date.strftime('%B %-d, %Y') }}</h1>
        <h1>RELEASES</h1>
      </div>
    </div>
  </div>
</div>
{% if True %}
  {% for publisher in issues|groupby('publisher.name') %}
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-lg-8 col-lg-offset-2">
        <h2>{{ publisher.grouper }}</h2>
        {% for row in publisher.list|sort(attribute='title.name')|batch(2) %}
          <div class="row">
          {% for issue in row %}
            <div class="col-sm-6">
              {{ issue_card(issue, g.user) }}
            </div>
          {% endfor %}
          </div>
        {% endfor %}
        </div>
      </div>
  </div>
  {% endfor %}
{% endif %}
{%- endblock content %}

{% block scripts %}
{{ super() }}
<script>
$(function() {

  $( ".add-remove-pull" ).click(function() {
    var $star = $(this);
    var titleId = $(this).data("titleid")
    if ($(this).hasClass('on-pull-list')) {
      var iteration = 2
    } else {
      var iteration = $(this).data('iteration')||1
    }
    switch (iteration) {
      case 1:
        $.post(
          '/ajax/add_to_pull_list',
          {'id': titleId}
        )
        .done(function(response) {
          $star.addClass( "on-pull-list" );
        });
        break;
      case 2:
        $.post(
          '/ajax/remove_from_pull_list',
          {'id': titleId}
        )
        .done(function(response) {
          $star.removeClass( "on-pull-list" );
        });
        break;
    }
    iteration++;
    if (iteration>2) iteration=1;
    $(this).data('iteration', iteration);
  });


  function encodeData(data) {
    return Object.keys(data).map(function(key) {
      return [key, data[key]].map(encodeURIComponent).join("=");
    }).join("&");
  }

  $( ".tweet" ).click(function() {
    var baseUrl = "https://twitter.com/intent/tweet?";
    var parameters = {"url": $(this).data("url"), "via": "longboxed", "text": $(this).data("title")};
    window.open(baseUrl+encodeData(parameters), 'Longboxed | Tweet', 'height=450,width=500');
    return false;
  });

  $( ".facebook" ).click(function() {
    var baseUrl = "http://www.facebook.com/sharer.php?";
    // var parameters = {"p[url]": $(this).data("url")}
    var parameters = {
      "p[url]": $(this).data("url"),
      "p[title]": $(this).data("title"),
    };
    window.open(baseUrl+encodeData(parameters), 'Longboxed | Facebook Share', 'height=450,width=500');
  });

});
</script>
{% endblock scripts %}







